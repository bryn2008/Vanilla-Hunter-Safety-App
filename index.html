<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GMaps.js &mdash; Geolocation</title>
  <link rel="apple-touch-icon" href="/image/icon.png" />
  <link rel="apple-touch-icon" sizes="72×72" href="/image/icon.png" />
  <link rel="apple-touch-icon" sizes="114×114" href="/image/icon.png" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script type="text/javascript" src="../gmaps.js"></script>
  <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="examples.css" />
  <script type="text/javascript">
    var map;

    var latOffset = 19.66468;
    var lonOffset = -145.014013;

    var latitude = 70.383092;
    var longitude = -148.547912;

    var hazardPath = [[
      [70.384092,-148.547912],
      [70.384092,-148.546912],
      [70.385092,-148.546912],
      [70.383092,-148.546912]
    ],[
      [70.384092,-148.548912],
      [70.388092,-148.548912],
      [70.383092,-148.547912],
      [70.383092,-148.547912]
    ],[
      [70.382092,-148.558912],
      [70.382092,-148.554912],
      [70.385092,-148.554912],
      [70.385092,-148.557912]
    ]];

    $(document).ready(function(){
      var map = new GMaps({
        el: '#map',
        zoom: 16,
        lat: latitude,
        lng: longitude,
        mapType: 'SATELLITE'
      });

      if (navigator.geolocation) {
          navigator.geolocation.watchPosition(changePosition);
      } else {
          x.innerHTML = "Geolocation is not supported by this browser.";
      }

      var thinIce = map.drawPolygon({
        paths: hazardPath[0],
        strokeColor: '#BBD8E9',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: '#BBD8E9',
        fillOpacity: 0.6
      });
      var crack = map.drawPolygon({
        paths: hazardPath[1],
        strokeColor: '#BBD8E9',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: '#BBD8E9',
        fillOpacity: 0.6
      });
      var hole = map.drawPolygon({
        paths: hazardPath[2],
        strokeColor: '#BBD8E9',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: '#BBD8E9',
        fillOpacity: 0.6
      });

      function changePosition(position) {
        map.setCenter(position.coords.latitude + latOffset, position.coords.longitude + lonOffset);
        map.addMarker({
          lat: position.coords.latitude + latOffset,
          lng: position.coords.longitude + lonOffset,
          draggable: true,
          fences: [thinIce,crack,hole],
          inside: function(m, f){
            if ("vibrate" in navigator ){
              navigator.vibrate([3000, 2000, 1000]);
            };
            alert('You are in DANGER!');
          }
        });
      }
    });
  </script>
</head>
<body>
  <h1>Vanilla &mdash; Hunter Safety App</h1>
  <div class="row">
    <div class="span11">
      <div id="map"></div>
    </div>
  </div>
</body>
</html>